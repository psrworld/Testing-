<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theme Mode System - Example</title>
    <style>
        /* CSS Variables for Theme System */
        :root {
            --theme-transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }

        /* Light Theme (Default) */
        :root,
        [data-theme="light"] {
            --color-background: #ffffff;
            --color-foreground: #000000;
            --color-primary: #0066cc;
            --color-secondary: #6b7280;
            --color-accent: #f59e0b;
            --color-muted: #f3f4f6;
            --color-border: #e5e7eb;
            --color-input: #ffffff;
            --color-card: #ffffff;
            --color-text-primary: #111827;
            --color-text-secondary: #6b7280;
            --color-text-muted: #9ca3af;
            --color-text-inverse: #ffffff;
        }

        /* Dark Theme */
        [data-theme="dark"] {
            --color-background: #0f172a;
            --color-foreground: #ffffff;
            --color-primary: #3b82f6;
            --color-secondary: #64748b;
            --color-accent: #fbbf24;
            --color-muted: #1e293b;
            --color-border: #334155;
            --color-input: #1e293b;
            --color-card: #1e293b;
            --color-text-primary: #f8fafc;
            --color-text-secondary: #cbd5e1;
            --color-text-muted: #64748b;
            --color-text-inverse: #000000;
        }

        /* Base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--color-background);
            color: var(--color-text-primary);
            transition: var(--theme-transition);
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--color-text-secondary);
        }

        .theme-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 3rem;
            flex-wrap: wrap;
        }

        .theme-button {
            background-color: var(--color-primary);
            color: var(--color-text-inverse);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--theme-transition);
        }

        .theme-button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .theme-button:active {
            transform: translateY(0);
        }

        .theme-button.secondary {
            background-color: var(--color-secondary);
        }

        .theme-button.accent {
            background-color: var(--color-accent);
        }

        .card {
            background-color: var(--color-card);
            border: 1px solid var(--color-border);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            transition: var(--theme-transition);
        }

        .card h3 {
            margin-bottom: 1rem;
            color: var(--color-text-primary);
        }

        .card p {
            color: var(--color-text-secondary);
            margin-bottom: 1rem;
        }

        .theme-input {
            width: 100%;
            background-color: var(--color-input);
            color: var(--color-text-primary);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 0.75rem;
            font-size: 1rem;
            transition: var(--theme-transition);
            margin-bottom: 1rem;
        }

        .theme-input:focus {
            outline: 2px solid var(--color-primary);
            outline-offset: 2px;
        }

        .status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--color-muted);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 2rem;
        }

        .status-item {
            text-align: center;
        }

        .status-label {
            font-size: 0.875rem;
            color: var(--color-text-secondary);
            margin-bottom: 0.25rem;
        }

        .status-value {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--color-primary);
        }

        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .demo-card {
            background-color: var(--color-card);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            transition: var(--theme-transition);
        }

        .demo-card:hover {
            border-color: var(--color-primary);
        }

        .demo-icon {
            width: 48px;
            height: 48px;
            background-color: var(--color-primary);
            border-radius: 50%;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--color-text-inverse);
        }

        @media (max-width: 640px) {
            .container {
                padding: 1rem;
            }
            
            .title {
                font-size: 2rem;
            }
            
            .theme-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .status {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">Theme Mode System</h1>
            <p class="subtitle">A complete dark/light theme system with TypeScript support</p>
        </header>

        <div class="theme-controls">
            <button class="theme-button" onclick="themeSystem.setTheme('light')">
                ‚òÄÔ∏è Light
            </button>
            <button class="theme-button secondary" onclick="themeSystem.setTheme('dark')">
                üåô Dark
            </button>
            <button class="theme-button accent" onclick="themeSystem.setTheme('system')">
                üîÑ System
            </button>
            <button class="theme-button" onclick="themeSystem.toggleTheme()">
                üîÄ Toggle
            </button>
        </div>

        <div class="status">
            <div class="status-item">
                <div class="status-label">Current Theme</div>
                <div class="status-value" id="current-theme">system</div>
            </div>
            <div class="status-item">
                <div class="status-label">Resolved Theme</div>
                <div class="status-value" id="resolved-theme">light</div>
            </div>
            <div class="status-item">
                <div class="status-label">System Preference</div>
                <div class="status-value" id="system-preference">light</div>
            </div>
        </div>

        <div class="demo-grid">
            <div class="demo-card">
                <div class="demo-icon">üé®</div>
                <h3>Styled Components</h3>
                <p>All components automatically adapt to the current theme using CSS variables.</p>
            </div>
            <div class="demo-card">
                <div class="demo-icon">‚ö°</div>
                <h3>Fast Switching</h3>
                <p>Instant theme switching with smooth transitions and no flash of unstyled content.</p>
            </div>
            <div class="demo-card">
                <div class="demo-icon">üíæ</div>
                <h3>Persistent Storage</h3>
                <p>Your theme preference is saved and restored across browser sessions.</p>
            </div>
            <div class="demo-card">
                <div class="demo-icon">üîÑ</div>
                <h3>System Sync</h3>
                <p>Automatically follows your system's dark/light mode preference when set to system.</p>
            </div>
        </div>

        <div class="card">
            <h3>Interactive Demo</h3>
            <p>Try changing the theme using the buttons above. Notice how all elements smoothly transition between themes.</p>
            <input type="text" class="theme-input" placeholder="This input field is themed too!" />
            <p>The theme system uses CSS variables to provide consistent theming across all components.</p>
        </div>

        <div class="card">
            <h3>Features</h3>
            <p>‚úÖ TypeScript support with full type definitions</p>
            <p>‚úÖ Zero dependencies and lightweight</p>
            <p>‚úÖ SSR-friendly with proper hydration</p>
            <p>‚úÖ Automatic system preference detection</p>
            <p>‚úÖ Persistent theme storage</p>
            <p>‚úÖ Event-driven architecture</p>
            <p>‚úÖ Framework agnostic</p>
        </div>
    </div>

    <script>
        // Theme Mode System JavaScript Implementation
        class ThemeModeSystem {
            constructor(config = {}) {
                this.config = {
                    defaultMode: 'system',
                    storageKey: 'theme-mode',
                    attribute: 'data-theme',
                    enableSystem: true,
                    disableTransitions: false,
                    ...config
                };
                
                this._theme = this.getStoredTheme() || this.config.defaultMode;
                this._resolvedTheme = this.resolveTheme(this._theme);
                this.mediaQuery = null;
                this.subscribers = new Set();
                this.mediaQueryListener = null;
                
                this.initializeMediaQuery();
                this.applyTheme();
            }

            get theme() {
                return this._theme;
            }

            get resolvedTheme() {
                return this._resolvedTheme;
            }

            setTheme(theme) {
                this._theme = theme;
                this._resolvedTheme = this.resolveTheme(theme);
                this.saveTheme(theme);
                this.applyTheme();
                this.notifySubscribers();
                this.dispatchEvent();
            }

            toggleTheme() {
                const currentResolved = this.resolvedTheme;
                const newTheme = currentResolved === 'light' ? 'dark' : 'light';
                this.setTheme(newTheme);
            }

            subscribe(callback) {
                this.subscribers.add(callback);
                return () => this.subscribers.delete(callback);
            }

            destroy() {
                if (this.mediaQuery && this.mediaQueryListener) {
                    this.mediaQuery.removeEventListener('change', this.mediaQueryListener);
                }
                this.subscribers.clear();
            }

            initializeMediaQuery() {
                if (!this.config.enableSystem) return;

                try {
                    this.mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                    this.mediaQueryListener = () => {
                        if (this._theme === 'system') {
                            this._resolvedTheme = this.resolveTheme('system');
                            this.applyTheme();
                            this.notifySubscribers();
                            this.dispatchEvent();
                        }
                    };
                    this.mediaQuery.addEventListener('change', this.mediaQueryListener);
                } catch (error) {
                    console.warn('Media query not supported:', error);
                }
            }

            resolveTheme(theme) {
                if (theme === 'system') {
                    if (this.mediaQuery) {
                        return this.mediaQuery.matches ? 'dark' : 'light';
                    }
                    return 'light';
                }
                return theme;
            }

            applyTheme() {
                const root = document.documentElement;
                
                if (this.config.disableTransitions) {
                    const css = document.createElement('style');
                    css.textContent = '*, *::before, *::after { transition: none !important; }';
                    document.head.appendChild(css);
                    
                    root.offsetHeight;
                    
                    setTimeout(() => {
                        document.head.removeChild(css);
                    }, 1);
                }

                root.setAttribute(this.config.attribute, this._resolvedTheme);
                root.style.colorScheme = this._resolvedTheme;
            }

            getStoredTheme() {
                try {
                    const stored = localStorage.getItem(this.config.storageKey);
                    return (stored === 'light' || stored === 'dark' || stored === 'system') ? stored : null;
                } catch (error) {
                    console.warn('Failed to read from localStorage:', error);
                    return null;
                }
            }

            saveTheme(theme) {
                try {
                    localStorage.setItem(this.config.storageKey, theme);
                } catch (error) {
                    console.warn('Failed to save to localStorage:', error);
                }
            }

            notifySubscribers() {
                this.subscribers.forEach(callback => {
                    try {
                        callback(this._theme, this._resolvedTheme);
                    } catch (error) {
                        console.error('Error in theme subscriber:', error);
                    }
                });
            }

            dispatchEvent() {
                const event = new CustomEvent('theme-changed', {
                    detail: { theme: this._theme, resolvedTheme: this._resolvedTheme }
                });
                window.dispatchEvent(event);
            }
        }

        // Initialize theme system
        const themeSystem = new ThemeModeSystem();

        // Update status display
        function updateStatus() {
            document.getElementById('current-theme').textContent = themeSystem.theme;
            document.getElementById('resolved-theme').textContent = themeSystem.resolvedTheme;
            
            const systemPreference = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            document.getElementById('system-preference').textContent = systemPreference;
        }

        // Subscribe to theme changes
        themeSystem.subscribe(updateStatus);

        // Listen for system preference changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateStatus);

        // Initial status update
        updateStatus();

        // Global event listener
        window.addEventListener('theme-changed', (event) => {
            console.log('Theme changed:', event.detail);
        });
    </script>
</body>
</html>